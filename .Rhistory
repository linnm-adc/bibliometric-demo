View(pubdata_karolinska)
pubdata_karolinska <- pubdata_raw %>%
filter(ISSN != "", ) %>%
mutate(Year = as.character(Year)) %>%
rename(issn = ISSN) %>%
filter(str_detect(Affiliations, pattern), Year==2023) %>%
group_by(issn) %>%
summarise(publications = n_distinct(DOI),
citations = sum(Cited.by, na.rm = TRUE))
pubdata_karolinska <- pubdata_raw %>%
filter(ISSN != "", ) %>%
mutate(Year = as.character(Year)) %>%
rename(issn = ISSN) %>%
filter(str_detect(Affiliations, pattern), Year==2023) %>%
group_by(issn) %>%
summarise(publications = n_distinct(DOI))
pubdata_karolinska <- pubdata_raw %>%
filter(ISSN != "", ) %>%
mutate(Year = as.character(Year)) %>%
rename(issn = ISSN) %>%
filter(str_detect(Affiliations, pattern), Year==2023) %>%
group_by(issn) %>%
reframe(publications = n_distinct(DOI),
citations = sum(Cited.by, na.rm = TRUE))
pubdata_karolinska <- pubdata_raw %>%
filter(ISSN != "", ) %>%
mutate(Year = as.character(Year)) %>%
rename(issn = ISSN) %>%
filter(str_detect(Affiliations, pattern), Year==2023) %>%
group_by(issn) %>%
reframe(publications = n_distinct(DOI))
pubdata_karolinska <- pubdata_raw %>%
filter(ISSN != "", ) %>%
mutate(Year = as.character(Year)) %>%
rename(issn = ISSN) %>%
filter(str_detect(Affiliations, pattern), Year==2023) %>%
group_by(issn)
pubdata_karolinska <- pubdata_raw %>%
filter(ISSN != "", ) %>%
mutate(Year = as.character(Year)) %>%
rename(issn = ISSN) %>%
filter(str_detect(Affiliations, pattern), Year==2023) %>%
group_by(issn) %>%
reframe(publications = n_distinct(DOI)),
pubdata_karolinska <- pubdata_raw %>%
filter(ISSN != "", ) %>%
mutate(Year = as.character(Year)) %>%
rename(issn = ISSN) %>%
filter(str_detect(Affiliations, pattern), Year==2023) %>%
group_by(issn) %>%
reframe(publications = n_distinct(DOI),
citations = sum(Cited.by, na.rm = TRUE))
benchmark_data_karolinska_raw <- list.files(
path = "data/benchmark_karolinska/",
pattern = "\\.csv$",
full.names = TRUE
) %>%
map_dfr(~ read_csv(
.x,
col_types = cols(
.default = col_character(),
`Cited by` = col_double()
)
)) %>%
select(Year, Title, `Cited by`, ISSN) %>%
mutate(issn = ifelse(ISSN == "", str_extract(ISBN, "\\d+"), ISSN))
View(benchmark_data_karolinska_raw)
pubdata_karolinska <- pubdata_raw %>%
filter(ISSN != "", ) %>%
mutate(Year = as.character(Year)) %>%
mutate(issn = ifelse(ISSN == "", str_extract(ISBN, "\\d+"), ISSN))
filter(str_detect(Affiliations, pattern), Year==2023) %>%
group_by(issn) %>%
reframe(publications = n_distinct(DOI),
citations = sum(Cited.by, na.rm = TRUE))
pubdata_karolinska <- pubdata_raw %>%
filter(ISSN != "", ) %>%
mutate(Year = as.character(Year)) %>%
mutate(issn = ifelse(ISSN == "", str_extract(ISBN, "\\d+"), ISSN)) %>%
filter(str_detect(Affiliations, pattern), Year==2023) %>%
group_by(issn) %>%
reframe(publications = n_distinct(DOI),
citations = sum(Cited.by, na.rm = TRUE))
pubdata_karolinska <- pubdata_raw %>%
filter(ISSN != "", ) %>%
mutate(Year = as.character(Year)) %>%
rename(issn = ISSN) %>%
filter(str_detect(Affiliations, pattern), Year==2023) %>%
group_by(issn) %>%
reframe(publications = n_distinct(DOI),
citations = sum(Cited.by, na.rm = TRUE))
benchmark_data_karolinska_raw <- list.files(
path = "data/benchmark_karolinska/",
pattern = "\\.csv$",
full.names = TRUE
) %>%
map_dfr(~ read_csv(
.x,
col_types = cols(
.default = col_character(),
`Cited by` = col_double()
)
)) %>%
select(Year, Title, `Cited by`, ISSN) %>%
rename(issn = ISSN) %>%
reframe(publications = n_distinct(DOI),
citations = sum(Cited.by, na.rm = TRUE))
benchmark_data_karolinska_raw <- list.files(
path = "data/benchmark_karolinska/",
pattern = "\\.csv$",
full.names = TRUE
) %>%
map_dfr(~ read_csv(
.x,
col_types = cols(
.default = col_character(),
`Cited by` = col_double()
)
)) %>%
rename(issn = ISSN) %>%
reframe(publications = n_distinct(DOI),
citations = sum(Cited.by, na.rm = TRUE))
benchmark_data_karolinska_raw <- list.files(
path = "data/benchmark_karolinska/",
pattern = "\\.csv$",
full.names = TRUE
) %>%
map_dfr(~ read_csv(
.x,
col_types = cols(
.default = col_character(),
`Cited by` = col_double()
)
))
benchmark_data_karolinska_raw <- list.files(
path = "data/benchmark_karolinska/",
pattern = "\\.csv$",
full.names = TRUE
) %>%
map_dfr(~ read_csv(
.x,
col_types = cols(
.default = col_character(),
`Cited by` = col_double()
)
)) %>%
rename(issn = ISSN) %>%
reframe(publications = n_distinct(DOI),
citations = sum(`Cited by`, na.rm = TRUE))
benchmark_data_karolinska_raw <- list.files(
path = "data/benchmark_karolinska/",
pattern = "\\.csv$",
full.names = TRUE
) %>%
map_dfr(~ read_csv(
.x,
col_types = cols(
.default = col_character(),
`Cited by` = col_double()
)
)) %>%
rename(issn = ISSN) %>%
group_by(issn) %>%
reframe(publications = n_distinct(DOI),
citations = sum(`Cited by`, na.rm = TRUE))
benchmark_data_karolinska_raw <- list.files(
path = "data/benchmark_karolinska/",
pattern = "\\.csv$",
full.names = TRUE
) %>%
map_dfr(~ read_csv(
.x,
col_types = cols(
.default = col_character(),
`Cited by` = col_double()
)
)) %>%
rename(issn = ISSN) %>%
group_by(issn) %>%
reframe(publications = n_distinct(DOI),
citations = sum(`Cited by`, na.rm = TRUE)) %>%
ungroup() %>%
mutate(citation_rate_benchmark = citations/publications)
pubdata_karolinska <- pubdata_raw %>%
filter(ISSN != "", ) %>%
mutate(Year = as.character(Year)) %>%
rename(issn = ISSN) %>%
filter(str_detect(Affiliations, pattern), Year==2023) %>%
group_by(issn) %>%
reframe(publications = n_distinct(DOI),
citations = sum(Cited.by, na.rm = TRUE))  %>%
mutate(citation_rate = citations/publications)
benchmark_data_karolinska_raw <- list.files(
path = "data/benchmark_karolinska/",
pattern = "\\.csv$",
full.names = TRUE
) %>%
map_dfr(~ read_csv(
.x,
col_types = cols(
.default = col_character(),
`Cited by` = col_double()
)
)) %>%
rename(issn = ISSN) %>%
group_by(issn) %>%
reframe(publications = n_distinct(DOI),
citations = sum(`Cited by`, na.rm = TRUE)) %>%
ungroup() %>%
mutate(citation_rate_benchmark = citations/publications)
# Create indicators for benchmark data:
impact <- pubdata_karolinska %>%
mutate(issn = ifelse(ISSN == "", str_extract(ISBN, "\\d+"), ISSN)) %>%
select(EID, issn, Year, Cited.by) %>%
left_join(benchmark_data_karolinska, by = c("issn"), relationship = "many-to-many") %>%
mutate(impact_ratio = Cited.by/citation_rate_benchmark)
# Create indicators for benchmark data:
impact <- pubdata_karolinska %>%
select(EID, issn, Year, Cited.by) %>%
left_join(benchmark_data_karolinska, by = c("issn"), relationship = "many-to-many") %>%
mutate(impact_ratio = Cited.by/citation_rate_benchmark)
# Create indicators for benchmark data:
impact <- pubdata_karolinska %>%
select(issn, Year, Cited.by) %>%
left_join(benchmark_data_karolinska, by = c("issn"), relationship = "many-to-many") %>%
mutate(impact_ratio = Cited.by/citation_rate_benchmark)
# Create indicators for benchmark data:
impact <- pubdata_karolinska %>%
left_join(benchmark_data_karolinska, by = c("issn"), relationship = "many-to-many") %>%
mutate(impact_ratio = Cited.by/citation_rate_benchmark)
# Create indicators for benchmark data:
impact <- pubdata_karolinska %>%
left_join(benchmark_data_karolinska, by = c("issn"), relationship = "many-to-many") %>%
mutate(impact_ratio = Cited.by/citation_rate_benchmark)
benchmark_data_karolinska<- list.files(
path = "data/benchmark_karolinska/",
pattern = "\\.csv$",
full.names = TRUE
) %>%
map_dfr(~ read_csv(
.x,
col_types = cols(
.default = col_character(),
`Cited by` = col_double()
)
)) %>%
rename(issn = ISSN) %>%
group_by(issn) %>%
reframe(publications = n_distinct(DOI),
citations = sum(`Cited by`, na.rm = TRUE)) %>%
ungroup() %>%
mutate(citation_rate_benchmark = citations/publications)
# Create indicators for benchmark data:
impact <- pubdata_karolinska %>%
left_join(benchmark_data_karolinska, by = c("issn"), relationship = "many-to-many") %>%
mutate(impact_ratio = Cited.by/citation_rate_benchmark)
pubdata_karolinska <- pubdata_raw %>%
filter(ISSN != "", ) %>%
mutate(Year = as.character(Year)) %>%
rename(issn = ISSN) %>%
filter(str_detect(Affiliations, pattern), Year==2023)
View(pubdata_karolinska)
# Create indicators for benchmark data:
impact <- pubdata_karolinska %>%
left_join(benchmark_data_karolinska, by = c("issn"), relationship = "many-to-many") %>%
mutate(impact_ratio = Cited.by/citation_rate_benchmark)
View(impact)
impact_overall <- impact %>%
summarise(impact_benchmark = mean(impact_benchmark, na.rm = TRUE)) %>%
ungroup()
# Summaries
impact_overall <- impact %>%
summarise(impact_ratio = mean(impact_ratio, na.rm = TRUE)) %>%
ungroup()
View(impact_overall)
# Create indicators for benchmark data:
impact <- pubdata_karolinska %>%
left_join(benchmark_data_karolinska, by = c("issn"), relationship = "many-to-many") %>%
mutate(impact_ratio = Cited.by/citation_rate_benchmark,
impact_ratio = ifelse(is.na(impact_ratio) & citation_rate_benchmark > 0, 0, impact_ratio),
impact_ratio = ifelse(is.infinite(impact_ratio), NA, impact_ratio)
)
# Summaries
impact_overall <- impact %>%
summarise(impact_ratio = mean(impact_ratio, na.rm = TRUE)) %>%
ungroup()
View(impact)
pubdata_karolinska <- pubdata_raw %>%
filter(ISSN != "", ) %>%
mutate(Year = as.character(Year)) %>%
rename(issn = ISSN) %>%
filter(str_detect(Affiliations, pattern), Year==2023)
# Create indicators for benchmark data:
impact <- pubdata_karolinska %>%
left_join(benchmark_data_karolinska, by = c("issn"), relationship = "many-to-many") %>%
mutate(impact_ratio = Cited.by/citation_rate_benchmark,
impact_ratio = ifelse(is.na(impact_ratio) & citation_rate_benchmark > 0, 0, impact_ratio),
impact_ratio = ifelse(is.infinite(impact_ratio), NA, impact_ratio)
)
View(pubdata_karolinska)
View(benchmark_data_karolinska_raw)
View(benchmark_data_karolinska_raw)
View(benchmark_data_karolinska)
View(pubdata_karolinska)
pubdata_karolinska <- pubdata_raw %>%
filter(ISSN != "", ) %>%
mutate(Year = as.character(Year)) %>%
rename(issn = ISSN) %>%
filter(str_detect(Affiliations, pattern), Year==2023) %>%
select(issn, Cited.by, Year) %>%
separate_rows(issn, sep = ";\\s*")
pubdata_karolinska <- pubdata_raw %>%
filter(ISSN != "", ) %>%
mutate(Year = as.character(Year)) %>%
rename(issn = ISSN) %>%
filter(str_detect(Affiliations, pattern), Year==2023) %>%
select(issn, Cited.by, Year) %>%
separate_rows(issn, sep = ";\\s*")
# Create indicators for benchmark data:
impact <- pubdata_karolinska %>%
left_join(benchmark_data_karolinska, by = c("issn"), relationship = "many-to-many") %>%
mutate(impact_ratio = Cited.by/citation_rate_benchmark,
impact_ratio = ifelse(is.na(impact_ratio) & citation_rate_benchmark > 0, 0, impact_ratio),
impact_ratio = ifelse(is.infinite(impact_ratio), NA, impact_ratio)
)
# Summaries
impact_overall <- impact %>%
summarise(impact_ratio = mean(impact_ratio, na.rm = TRUE)) %>%
ungroup()
impact <- pubdata_karolinska %>%
left_join(benchmark_data_karolinska, by = c("issn"), relationship = "many-to-many") %>%
mutate(impact_ratio = Cited.by/citation_rate_benchmark,
impact_ratio = ifelse(is.na(impact_ratio) & citation_rate_benchmark > 0, 0, impact_ratio),
impact_ratio = ifelse(is.infinite(impact_ratio), NA, impact_ratio)
)
# Summaries
impact_overall <- impact %>%
summarise(impact_ratio = mean(impact_ratio, na.rm = TRUE)) %>%
ungroup()
# Summaries
impact_overall <- impact %>%
summarise(impact_ratio = mean(impact_ratio, na.rm = TRUE)) %>%
ungroup()
benchmark_data_karolinska_raw <- list.files(
path = "data/benchmark_karolinska/",
pattern = "\\.csv$",
full.names = TRUE
) %>%
map_dfr(~ read_csv(
.x,
col_types = cols(
.default = col_character(),
`Cited by` = col_double()
)
)) %>%
rename(issn = ISSN) %>%
group_by(issn)
benchmark_data_karolinska <- benchmark_data_karolinska_raw %>%
reframe(publications = n_distinct(DOI),
citations = sum(`Cited by`, na.rm = TRUE)) %>%
ungroup() %>%
mutate(citation_rate_benchmark = citations/publications) %>%
select(-citations, -publications)
# Create indicators for benchmark data:
impact <- pubdata_karolinska %>%
left_join(benchmark_data_karolinska, by = c("issn"), relationship = "many-to-many") %>%
mutate(impact_ratio = Cited.by/citation_rate_benchmark,
impact_ratio = ifelse(is.na(impact_ratio) & citation_rate_benchmark > 0, 0, impact_ratio),
impact_ratio = ifelse(is.infinite(impact_ratio), NA, impact_ratio)
)
# Summaries
impact_overall <- impact %>%
summarise(impact_ratio = mean(impact_ratio, na.rm = TRUE)) %>%
ungroup()
#### SAVE RESULTS ####
wb_results <- createWorkbook("wb_results")
writeData(wb_results, addWorksheet(wb_results, "Pub Timeline"), pub_per_year)
writeData(wb_results, addWorksheet(wb_results, "SubjAreas"), subjAreas)
writeData(wb_results, addWorksheet(wb_results, "ScientificQuality"), scientificQuality)
############# PREAMBLE #################
# The purpose of this script is to create the main bibliometric indicators
rm(list=ls())
### LOAD PACKAGES
# Just once per project: Install all packages and associated versions:
install.packages("renv")
############# PREAMBLE #################
# The purpose of this script is to create the main bibliometric indicators
rm(list=ls())
### LOAD PACKAGES
# Just once per project: Install all packages and associated versions:
# install.packages("renv")
# renv::restore()
# Load packages specific for this script:
pacman::p_load("readxl", "openxlsx", "tidyverse", "pbapply", "bibliometrix", "stringi")
proj_path <- rstudioapi::getActiveProject()
proj_name <- basename(proj_path)
if (proj_name == "Bibliometric demo") {
message("Project 'bibliometrics' is loaded. Starting script...")
} else {
stop("Warning - This script must be run from the 'bibliometric demo' project")
}
######### LOAD DATA ################
#pubdata_raw <- read.xlsx("Work Data/scopus_no_duplicates_cancer_type.xlsx")
pubdata_raw <- read.csv("data/scopus_clean.csv", stringsAsFactors = FALSE)
######## Small check on scopus data ###########
required_vars <- c("EID", "Document.Type", "ISSN", "Year", "Cited.by")
missing_vars <- setdiff(required_vars, names(pubdata_raw))
if (length(missing_vars) > 0) {
stop(paste("Missing variables:", paste(missing_vars, collapse = ", ")))
} else {
print("All required variables are present.")
}
############## Investigate data ################
#######################################
print(paste0("Number of rows: ", nrow(pubdata_raw)))
names(pubdata_raw)
str(pubdata_raw)
############## RESULTS ################
#######################################
#### Publication Volume ####
pub_per_year <- pubdata_raw %>%
group_by(Year) %>% summarise(publications = n_distinct(EID)) %>% ungroup()
#### Research Areas ####
sourcelist <- readRDS("data/sourcelist2020")
subjAreas <- pubdata_raw %>%
select(EID, issn = ISSN) %>%
left_join(select(sourcelist, issn, sjr, subjectArea), by = "issn") %>% distinct() %>%
group_by(subjectArea) %>% summarise(publications = n_distinct(EID)) %>% ungroup() %>%
arrange(desc(publications)) %>% na.omit
#### Scientific Quality ####
top_subjectareas <- subjAreas %>%
mutate(cum_share = cumsum(publications)/sum(publications)) %>%
filter(cum_share < 0.8) %>%
summarise(n = n() + 1) %>% pull(n)
top_80subjectareas <- subjAreas %>%
filter(1:n() <= top_subjectareas) %>% pull(subjectArea)
#Create benchmark percentiles
sjr_benchmark <- sourcelist %>%
filter(subjectArea %in% top_80subjectareas) %>%
select(issn, sjr, subjectArea) %>% distinct() %>% na.omit %>%
summarise(p99 = quantile(sjr, probs = 0.99),
p95 = quantile(sjr, probs = 0.95),
p90 = quantile(sjr, probs = 0.90))
scientificQuality <- pubdata_raw %>%
select(EID, issn = ISSN) %>%
left_join(select(sourcelist, issn, sjr), by = "issn") %>% distinct() %>%
cbind(sjr_benchmark) %>%
mutate(top1 = ifelse(sjr >= p99, 1, 0),
top5 = ifelse(sjr >= p95, 1, 0),
top10 = ifelse(sjr >= p90, 1, 0)) %>%
summarise(top1 = sum(top1, na.rm = TRUE),
top5 = sum(top5, na.rm = TRUE),
top10 = sum(top10, na.rm = TRUE)) %>%
mutate(top1_share = top1/n_distinct(pubdata_raw$EID),
top5_share = top5/n_distinct(pubdata_raw$EID),
top10_share = top10/n_distinct(pubdata_raw$EID),
publications = n_distinct(pubdata_raw$EID))
#### SCIENTIFIC IMPACT ####
# Two ISSN = paper version and online version
# Clean pubdata
karolinska_names <- c("Karoliniska", "Karolinska Sjukhuset", "Karolinska Institute", "Karolinska Institutet", "KI", "KS")
pattern <- regex(
paste0("\\b(", paste(karolinska_names, collapse = "|"), ")\\b"),
ignore_case = TRUE
)
pubdata_karolinska <- pubdata_raw %>%
filter(ISSN != "", ) %>%
mutate(Year = as.character(Year)) %>%
rename(issn = ISSN) %>%
filter(str_detect(Affiliations, pattern), Year==2023) %>%
select(issn, Cited.by, Year) %>%
separate_rows(issn, sep = ";\\s*")
# Load benchmark data
benchmark_data_karolinska_raw <- list.files(
path = "data/benchmark_karolinska/",
pattern = "\\.csv$",
full.names = TRUE
) %>%
map_dfr(~ read_csv(
.x,
col_types = cols(
.default = col_character(),
`Cited by` = col_double()
)
)) %>%
rename(issn = ISSN) %>%
group_by(issn)
benchmark_data_karolinska <- benchmark_data_karolinska_raw %>%
reframe(publications = n_distinct(DOI),
citations = sum(`Cited by`, na.rm = TRUE)) %>%
ungroup() %>%
mutate(citation_rate_benchmark = citations/publications) %>%
select(-citations, -publications)
# Create indicators for benchmark data:
impact <- pubdata_karolinska %>%
left_join(benchmark_data_karolinska, by = c("issn"), relationship = "many-to-many") %>%
mutate(impact_ratio = Cited.by/citation_rate_benchmark,
impact_ratio = ifelse(is.na(impact_ratio) & citation_rate_benchmark > 0, 0, impact_ratio),
impact_ratio = ifelse(is.infinite(impact_ratio), NA, impact_ratio)
)
# Summaries
impact_overall <- impact %>%
summarise(impact_ratio = mean(impact_ratio, na.rm = TRUE)) %>%
ungroup()
#### SAVE RESULTS ####
wb_results <- createWorkbook("wb_results")
writeData(wb_results, addWorksheet(wb_results, "Pub Timeline"), pub_per_year)
writeData(wb_results, addWorksheet(wb_results, "SubjAreas"), subjAreas)
writeData(wb_results, addWorksheet(wb_results, "ScientificQuality"), scientificQuality)
writeData(wb_results, addWorksheet(wb_results, "Impact"), impact_overall)
date_str <- format(Sys.Date(), "%Y%m%d")
saveWorkbook(wb_results, paste0("output/results_bibliometric_indicators_", date_str, ".xlsx"), overwrite = FALSE)
